//
//  Reed Plate Data.swift
//  AccordionDSLab
//
//  Created by Dalibor Jovic on 20. 5. 2025..
//

import SwiftData
import Foundation

struct ReedPlateData: DataPopulator {
    static var modelType: any PersistentModel.Type { ReedPlateSection.self }
    
    static func populate(modelContext: ModelContext) {
        // MARK: - DATA POPULATION METHOD
        do {
            let sortDescriptor = SortDescriptor<ReedPlateSection>(\.order)
            let fetchDescriptor = FetchDescriptor<ReedPlateSection>(sortBy: [sortDescriptor])
            let sections = try modelContext.fetch(fetchDescriptor)
            
            // Checking if the database is empty before populating
            if sections.isEmpty {
                // MARK: -------------------------------------------------- 9.0. REED PLATE --------------------------------------------------
                let reedPlate = ReedPlateSection(title: "Reed Plate", order: 1, subsections: [
                    ReedPlateSubsection(title: "The Operating Principle of the Free Reed", order: 1, paragraphs: [
                        ReedPlateText(text: "The free reed represents a crucial component that enables the accordion to produce tones. This sound source is forced to oscillate by the action of an air current, moving partially in free space and partially within a channel in the reed plate to which it is firmly attached. The free reed itself cannot produce a sound wave or form a tone. It requires a frame – a channel through which air flows. Oscillating within this frame, the reed interrupts the continuous flow of air at a specific rate, or frequency. It is precisely this alternating interruption of the air current that creates the sound we hear.")
                    ]),
                    ReedPlateSubsection(title: "Historical Development of the Free Reed", order: 2, paragraphs: [
                        ReedPlateText(text: "The free reed was originally conceived in ancient Southeast Asia, where the Chinese instrument *sheng* was constructed based on the principle of its oscillation. Initially, the reeds were made of cane, and later from brass, a copper alloy known since the Bronze Age, a period of significant development in metallurgy and the production of bronze artifacts. Interestingly, the first accordions also had free reeds made of brass until the mid-19th century.")
                    ]),
                    ReedPlateSubsection(title: "Modern Materials and the Significance of the Free Reed", order: 3, paragraphs: [
                        ReedPlateText(text: "Over time, the design and size of the free reed changed and adapted to the acoustic requirements of the accordion. Today, they are made exclusively of steel, a material that ensures precision and sound quality. In short, the reed plate, with its oscillating lamella and interaction with the air current, forms the basis for creating the recognizable sound of the accordion.")
                    ])
                ])
                
                // MARK: -------------------------------------------------- 9.1. CONSTRUCTION OF THE REED PLATE --------------------------------------------------
                
                let reedPlateConstruction = ReedPlateSection(title: "Construction of the Reed Plate", order: 2, subsections: [
                    ReedPlateSubsection(title: "Essential Component", order: 1, paragraphs: [
                        ReedPlateText(text: "**The reed plate** is an essential component that creates the accordion's recognizable sound. Understanding its construction is key to comprehending how this instrument functions.", imageName: "9.1._free_reed_durall")]),
                    ReedPlateSubsection(title: "Basic Function and Construction Variations", order: 2, paragraphs: [
                        ReedPlateText(text: "The reed plate represents the heart of the accordion's sound mechanism. At its core, it's an alternately symmetrical assembly containing two identical functional units. This symmetry is characteristic of **unisono accordions**, where one unit responds to the airflow during the bellows' expansion, and the other to the opposite direction of airflow during the bellows' compression. Both units are designed to produce the same tone."),
                        ReedPlateText(text: "However, the situation is different in **bisonoric instruments**. While there are still two functional units within a single plate, they are not symmetrical. Furthermore, the reeds within the same plate are different, allowing for the production of distinct tones depending on the direction of bellows movement.")]),
                    ReedPlateSubsection(title: "Historical Development", order: 3, paragraphs: [
                        ReedPlateText(text: "In the early stages of accordion development, when the instrument didn't have a large sound intensity, the reed plate was relatively simple. It was formed by simply cutting a slot in a plate up to 1 mm thick. This construction allowed the reed to oscillate with bidirectional airflow.")]),
                    ReedPlateSubsection(title: "Modern Construction and Elements", order: 4, paragraphs: [
                        ReedPlateText(text: "Advances in acoustic requirements have led to the significantly more complex construction of the reed plate found in modern accordions today. This plate now includes basic and additional elements, whose presence primarily depends on the size of the reed itself, and thus on the frequency of the tone it needs to produce.")]),
                    ReedPlateSubsection(title: "Core Elements of the Reed Plate:", order: 5, paragraphs: [
                        ReedPlateText(text: """
                            Every reed plate invariably contains the following three key components:  
                            \u{25CF}\t**Free Reed:** A thin, elastic metal strip that vibrates when air flows over it, creating sound. Its dimensions and mass directly influence the pitch of the tone.  
                            \u{25CF}\t**Reed Plate:** A metal plate with a precisely cut slot (channel) within which the free reed is housed. It provides support for the reed and directs the airflow.  
                            \u{25CF}\t**Rivet for Attaching the Reed to the Plate:** A small metal element that firmly connects the base of the free reed to the plate, ensuring a stable connection and allowing the reed to vibrate freely above the channel.
                            """, imageName: "9.1._free_reed_cagnoni", imageTitle: "Basic and additional elements")]),
                    ReedPlateSubsection(title: "Additional Elements for Mid and Low Frequencies:", order: 6, paragraphs: [
                        ReedPlateText(text: """
                            For producing mid and low-frequency tones, the reed plate typically also includes additional elements that optimize airflow and oscillation efficiency:  
                            \u{25CF}\t**Reed Valve:** A thin strip of elastic material (traditionally leather, but increasingly PET film) glued to the reed plate on the side of the channel where air exits. Its role is to allow air to pass when the corresponding reed is active, and to close the channel when air flows in the opposite direction, preventing air loss and improving bellows efficiency.  
                            \u{25CF}\t**Reed Valve Spring:** A thin, leaf-shaped metal element placed on larger leather reed valves to enhance their elasticity and seating pressure against the plate. This extends the valve's lifespan and ensures better sealing. One end of the spring is attached to a holder, while the other is free and slightly curved.  
                            \u{25CF}\t**Spring Holder:** A small round element glued to the fixed end of the reed valve strip and serving as a support for the reed valve spring.
                            """)]),
                    ReedPlateSubsection(title: "Parallel Construction in Unisono Systems", order: 7, paragraphs: [
                        ReedPlateText(text: "It's important to note that in unisono accordions, due to their symmetrical nature, all these basic and additional elements are installed in pairs within a single reed plate, one set for each direction of airflow.")]),
                    ReedPlateSubsection(title: "More Details on the Reed Valve:", order: 8, paragraphs: [
                        ReedPlateText(text: "The reed valve plays a crucial role in the efficient functioning of the accordion. Its task is to allow the unimpeded passage of airflow when the corresponding free reed is oscillating, while simultaneously hermetically sealing the channel on the plate in front of the stationary reed due to the opposite direction of bellows movement. This prevents unnecessary air consumption and optimizes bellows capacity. For this reason, the overlap of the leather or film strip of the reed valve over the plate channel must be at least 1.5 to 2.0 mm."),
                        ReedPlateText(text: "For larger reeds, where airflow is more significant, a thin leaf spring is added to the leather reed valve. This spring, slightly shorter than the reed valve strip itself, enhances its elasticity and pressure on the plate, ensuring better sealing and extending the valve's working life. The spring is attached by a holder at one end, while the other end is free and slightly bent for optimal flexibility."),
                        ReedPlateText(text: "Interestingly, in accordions that have been unused for a long time, the leather reed valve strips on the underside of the reed block can lose elasticity due to their own weight. In such cases, the leaf springs also act as a support, maintaining the necessary stability of the reed valve. For medium-sized reeds, springs are usually not used, while for small high-pitch reeds, the reed valve is completely omitted due to minimal air losses.")]),
                    ReedPlateSubsection(title: "Reed Valve Material: Evolution from Leather to PET Film:", order: 9, paragraphs: [
                        ReedPlateText(text: "Traditionally, reed valves were made of thin leather, an organic material susceptible to changes due to moisture, dryness, and dust, which eventually leads to a loss of elasticity. Regular accordion use somewhat maintains leather's elasticity thanks to airflow, but periodic replacement is inevitable."),
                        ReedPlateText(text: "In modern accordions, leather is increasingly being replaced by thin **polyethylene terephthalate (PET) films**. This synthetic material, patented in 1941 by English chemists John Rex Whinfield and James Tennant Dickson, belongs to the group of plastomers and possesses superior characteristics. Also known as **Dacron** in Western countries and **Lavsan** in Russia, PET offers high strength, weather resistance, low density, exceptional elasticity, resistance to moisture and chemical influences, as well as a wide temperature range (-70°C to 150°C) and the ability to be glued. Manufacturers often use multi-layered PET strips of varying thicknesses to achieve optimal elasticity and bending resistance during intense airflows. Today, PET is the preferred material for reed valves, especially for mid and high-frequency reed plates.", imageName: "9.1._reed_pet_valve", imageTitle: "Free Reed with PET strip")]),
                    ReedPlateSubsection(title: "Materials and Manufacturing of Reed Plates", order: 10, paragraphs: [
                        ReedPlateText(text: """
                            The choice of materials for reed plates has also evolved. In the past, zinc was used due to its lightness and workability. Plates were produced by precise die-casting with manual finishing of the channels. In the early 20th century, aluminum became popular, and today its alloys are used:  
                            \u{25CF}\t**Duralumin:** An alloy of aluminum with copper and magnesium, lighter and significantly harder than pure aluminum. It's used for the serial production of medium-quality reed plates.  
                            \u{25CF}\t**Avional (2000 and 5000 series):** Special aluminum alloys with added copper, magnesium, manganese, chromium, silicon, and other elements. These are used for high-quality plates in concert accordions, offering hardness from 50 to 150 HB (Brinell scale). The Brinell method, introduced by Swedish engineer August Brinell in 1900, is a standard for measuring material hardness.  
                            The density, hardness, and stiffness of the reed plate material significantly influence the quality of the produced tone. Reed plates are cut from rolled sheets of aluminum alloys on automatic presses. Channels are machined with extreme precision using an electro-discharge machining (EDM) wire process or laser machining on CNC machines. The quality of the channel edge finishing is critical for forming a clear and resonant sound during reed oscillation.
                            """)]),
                    ReedPlateSubsection(title: "Production of Free Reeds", order: 11, paragraphs: [
                        ReedPlateText(text: "Serial production of high-pitch reeds involves machine processing of the longitudinal cross-section by grinding a steel strip using profiled grinding tools. This operation forms the precise profile of the reed from base to tip. Then, in highly precise tools, individual reeds are produced by cutting with a tolerance of ±10 cents relative to the desired frequency."),
                        ReedPlateText(text: "The length of the reed directly affects the sound spectrum. Longer reeds produce a richer sound with more higher harmonics, but require larger reed block dimensions. For low tones, where long reeds would be impractical, mass is added to the reed tip or a specially designed longitudinal profile is used. The reed body can be rectangular or slightly trapezoidal (with a side angle of 1.5° to 2.0°), with the width decreasing towards the tip, which is more pronounced for higher-frequency reeds."),
                        ReedPlateText(text: "The material from which free reeds are made is **alloyed steel with high elasticity**, often designated as **otel special C100S**. Although some manufacturers have experimented with stainless steels, they haven't shown optimal characteristics other than corrosion resistance. The longitudinal profile of the reed varies depending on the desired tone, and the distribution of mass along the reed is the primary factor determining the pitch.", imageName: "9.1._free_reed_profile", imageTitle: "Longitudinal Profile of the Free Reed for Various Oscillation Frequencies"),
                        ReedPlateText(text: "Swedish metallurgical companies are traditionally known for producing the highest quality steel, so high-quality reeds are often made from **Swedish alloyed special spring steels** that offer exceptional elasticity, strength, toughness, and anticorrosive properties. For optimal oscillation, the stiffness of the connection between the reed and the plate is crucial, which is achieved exclusively by **riveting**, a process that ensures maximum joint strength through material deformation.")])
                ])
                
                // MARK: -------------------------------------------------- 9.2. DEPENDENCE OF REED DIMENSION ON OSCILLATION FREQUENCY --------------------------------------------------
                
                let reedPlateDependences = ReedPlateSection(title: "Dependence of Reed Dimensions on Oscillation Frequency", order: 3, subsections: [
                    ReedPlateSubsection(title: "Dependence of Reed Dimensions on Oscillation Frequency", order: 1, paragraphs: [
                        ReedPlateText(text: "Free reeds are crucial elements that create sound through their vibration. Their physical dimensions—primarily **length, width, and thickness**—along with the material they're made from, have a decisive impact on the **pitch (frequency)** of the tone produced.")]),
                    ReedPlateSubsection(title: "Primary Influence of Reed Length", order: 2, paragraphs: [
                        ReedPlateText(text: "The most significant reed dimension in determining pitch is its **length**. Similar to strings on a guitar or piano, longer reeds naturally oscillate slower, producing lower frequencies, which we hear as deeper tones. Conversely, shorter reeds vibrate faster, creating higher frequencies, or high-pitched tones. This **inverse proportionality between reed length and frequency** is fundamental to the construction of an accordion with a wide range of tones. For every note on the instrument, a reed of specific length is required to achieve the desired frequency.")]),
                    ReedPlateSubsection(title: "Influence of Reed Thickness and Width", order: 3, paragraphs: [
                        ReedPlateText(text: "Beyond length, the **thickness (or height)** of the reed significantly affects its **stiffness**. A thicker reed is harder to bend and initiate into oscillation, meaning it will require a higher minimum air pressure to begin vibrating and producing sound. Thickness also influences the oscillation frequency itself; thicker reeds, given the same length and material, generally tend to oscillate at lower frequencies compared to thinner ones, but this influence is more complex and tied to stiffness."),
                        ReedPlateText(text: "The **width** of the reed has a smaller direct impact on the tone's frequency compared to its length and thickness. However, wider reeds have a larger surface area exposed to air pressure, which can result in a **sound intensity**. Additionally, width influences the reed's total moment of inertia, which can indirectly modulate its vibrational characteristics.")]),
                    ReedPlateSubsection(title: "Importance of Manufacturing Material", order: 4, paragraphs: [
                        ReedPlateText(text: "The material from which the reed is made is extremely important. Different materials possess different **elastic properties (bending stiffness)** and **density**. Materials with a higher modulus of elasticity (greater stiffness) will tend to oscillate at higher frequencies, while denser materials will tend to oscillate slower. Traditionally, **steel** is used for reeds due to its good elasticity and durability. Carefully selected specific mechanical characteristics of the steel ensure that the reed can accurately vibrate at the desired frequency and withstand continuous use.")]),
                    ReedPlateSubsection(title: "Adapting Length and Frequency in Construction", order: 5, paragraphs: [
                        ReedPlateText(text: "In accordion construction, the physical size of the instrument imposes limitations on the maximum possible length of reeds, especially for the lowest notes. Theoretical calculations might indicate very long reeds for deep tones, but in practice, their length must be adapted to fit within the accordion's casing. Instead of drastically shortening the length, which would significantly raise the frequency, manufacturers sometimes alter the **mass distribution** along the reed. By adding mass to specific parts of the reed, particularly closer to the free end, the oscillation frequency can be lowered without requiring excessive length. This technique allows for the achievement of deeper tones in a more compact instrument.", imageName: "9.2._free_reed_mass", imageTitle: "Adding mass to the Free Reed")]),
                    ReedPlateSubsection(title: "Role of Air Pressure and Reed Stiffness", order: 6, paragraphs: [
                        ReedPlateText(text: "For the reed to oscillate correctly and produce a tone, a certain **minimum air pressure** is essential. This pressure must be sufficient to overcome the reed's inertia and stiffness and set it into vibration. Reeds of different dimensions and stiffness require different minimum pressures. There is also a maximum air pressure beyond which the reed may stop vibrating correctly or even be damaged. The **stiffness of the reed**, which is directly related to its material and dimensions (especially thickness), must be carefully calculated. It must be great enough to withstand the maximum anticipated air pressure without deformation that would impede oscillation, but also small enough to allow sensitive reaction to minimal pressure and produce the desired tone.")]),
                    ReedPlateSubsection(title: "Concluding Overview of Dimension and Material Dependence", order: 7, paragraphs: [
                        ReedPlateText(text: "Precisely determining the dimensions (length, width, and thickness) and carefully selecting the material for free reeds are critical factors in accordion manufacturing. These characteristics directly determine the **pitch, sound intensity, and quality** of each individual tone. Balancing theoretical calculations with the practical limitations of instrument construction, while also considering the required air pressure and reed stiffness, is key to creating a functional and high-quality accordion with a rich and balanced sound.")])
                ])
                
                //MARK: -------------------------------------------------- 9.3. FREE REED DIMENSIONING --------------------------------------------------
                
                let reedPlateDimensioning = ReedPlateSection(title: "Free Reed Dimensioning", order: 4, subsections: [
                    ReedPlateSubsection(title: "Reed Design: From Theory to Perfect Tone", order: 1, paragraphs: [
                        ReedPlateText(text: "The process of designing **reeds**, the small vibrating elements within an accordion that produce sound, begins with a theoretical calculation of their length. This calculation accounts for the reed's width and thickness, which can be varied independently. However, this is merely a starting point."),
                        ReedPlateText(text: "In practice, to achieve optimal sound and compact accordion dimensions, the theoretical reed length is adjusted. This correction process uses **interpolation**, meaning the longest reeds, responsible for low tones, are shortened, while the shortest reeds, for high tones, are lengthened. This approach helps optimize the size of the reed itself, as well as the space within the **reed block** that resonates with it, influencing the richness of the sound (the accordion's *corpus*).")]),
                    ReedPlateSubsection(title: "Technological Constraints and Innovative Solutions", order: 2, paragraphs: [
                        ReedPlateText(text: "During design, engineers must also consider manufacturing limitations. For instance, the minimum reed length for the highest tones (like A4, around 3520 Hz) cannot be arbitrarily small due to practical reasons. In some accordion models, this minimum length is 12 mm, even if theoretical calculations suggest a smaller value. Similarly, the maximum length of reeds for the lowest tones (like A2, around 110 Hz) is limited by the optimal resonance chamber height and the accordion's overall dimensions. Thus, it might be 45 mm, while the length of the reed plate it's attached to is 54 mm."),
                        ReedPlateText(text: "Based on these minimum and maximum lengths, a curve is created representing the ideal reed lengths for all tones within the accordion's range. Then, a second curve is constructed reflecting technologically feasible lengths. Where these two curves intersect, the **reference reed** is found. This reed has an ideal length that is also practical for manufacturing, so its length is not adjusted. It possesses sufficient rigidity and a uniform thickness across its entire surface.")]),
                    ReedPlateSubsection(title: "High-Tone Adjustment: Thin Precision", order: 3, paragraphs:
                                            [ReedPlateText(text: "High-pitched reeds, whose frequency is higher than that of the reference reed, would naturally have greater stiffness than required. Conversely, low-pitched reeds, with a frequency lower than the reference, would have less than optimal stiffness, especially considering the maximum air pressure generated during playing."),
                                             ReedPlateText(text: "To reduce excessive stiffness and the minimum required air pressure for high tones whose length has been extended, the **reed tip is tapered**, and its sides are processed to create an elongated, **trapezoidal, wedge-like shape**. This shape helps increase the oscillation frequency. In addition, the **reed's thickness is adjusted**. The reference reed, which typically has the highest frequency, has a constant thickness (e.g., 0.05 mm for A4). For other high-pitched reeds whose length has been increased, the technologically adjusted thickness is determined by interpolation.")]),
                    ReedPlateSubsection(title: "Shaping the Sound: Geometry and Thickness in Harmony", order: 4, paragraphs: [
                        ReedPlateText(text: "To achieve precise oscillation frequencies, the geometric shape and dimensions of the reeds are carefully determined during production. The **reed's thickness gradually changes from the tip, where it's thinnest, towards the base, where it's thickest**. A change in frequency is directly related to a change in thickness. Reducing the thickness at the reed's base lowers the frequency, while reducing the thickness at the tip increases the frequency. Reducing thickness also decreases stiffness but increases the reed's elasticity."),
                        ReedPlateText(text: "Due to the tapering width and reduction in thickness at the tip, the reed adopts a **pyramidal form** instead of a prismatic one. This transition to a pyramidal shape alters how the reed vibrates, which is reflected in a change of the constant describing its fundamental oscillation. The ratio of the squares of these constants for prismatic and pyramidal shapes indicates the maximum possible change in oscillation frequency by altering the reed's shape. The degree of frequency change depends on the ratio of the thickness at the tip (*hv*) to the thickness at the base (*hp*). If these thicknesses are equal, the frequency does not change. If the thickness at the tip is reduced to zero, the maximum frequency increase is achieved. The frequency change for high tones between these two extremes can be visually tracked using graphical interpolation.")]),
                    ReedPlateSubsection(title: "Low Tones: Adding Mass for Depth", order: 5, paragraphs: [
                        ReedPlateText(text: "For low-pitched reeds, whose theoretical length has been reduced, the desired frequency is achieved by adding a small amount of material (by soldering) to the very tip of the reed. This way, reeds of the same length and width can have different oscillation frequencies, depending on the mass added to the tip. The added mass has the same width as the reed itself but different heights and lengths for different frequencies. Attaching additional mass allows for the production of low tones with relatively short reeds, which is particularly important for reeds on the bass side."),
                        ReedPlateText(text: "The reed's width itself does not directly affect the oscillation frequency, but it influences more complex vibration modes, and thus the **timbre** (tone color) and mechanical durability of the reed. For the timbre to be similar across low and high tones, the **length-to-width** ratio of the reed should gradually decrease from low to high tones.")]),
                    ReedPlateSubsection(title: "Manufacturing Precision: From Empiricism to Computers", order: 6, paragraphs: [
                        ReedPlateText(text: "In the past, the dimensioning of reed plates and reeds was based on experience and trial-and-error. Today, the design of reed plates is carried out with the help of modern **CAD (Computer-Aided Design)** systems. **Modal analysis** and the **finite element method** make it possible to simulate even more complex reed vibration modes, considering static and dynamic air pressure. Particularly with thin, high-frequency reeds, **torsional** oscillations can occur, which may disrupt sound wave formation. For this reason, reeds with a more pronounced trapezoidal shape and a profile where the thickness gradually decreases from the base to the tip are more suitable for high tones. Torsional oscillations can be minimized by precise positioning of the reed relative to the channel on the plate, ensuring that the lateral clearance is symmetrically distributed on both sides of the reed."),
                        ReedPlateText(text: "The oscillation frequency of a reed depends on its shape, dimensions, and material. This frequency can slightly change when the **reed plate is mounted on the reed block**, and the final frequency is only achieved when the reed block is installed in the accordion's body. Therefore, in manufacturing, approximate dimensions are first calculated, then verified during preparations for mass production. Only dimensions obtained through computer modeling can be directly applied in production, but even then, minor frequency deviations are possible. These deviations are corrected by final, automated technological operations, ensuring the accurate oscillation frequency of the reed, which is confirmed by final testing.")])
                ])
                
                // MARK: -------------------------------------------------- 9.4. FUNCTIONAL PRINCIPLE OF FREE REED OSCILLATION --------------------------------------------------
                
                let reedPlateFunctional = ReedPlateSection(title: "Functional Principle of Reed Oscillation", order: 5, subsections: [
                    ReedPlateSubsection(title: "The Reed Oscillation Mechanism: More Than Just Air Pressure", order: 1, paragraphs: [
                        ReedPlateText(text: "Many accordionists and technicians simplify the explanation of reed oscillation, reducing it to direct air pressure initiating movement and the reed's own elasticity bringing it back. However, this picture is incomplete and doesn't explain why the reed's movement is actually **oscillatory**—that is, why it repeats rather than stopping in a single deformed position.")
                    ]),
                    ReedPlateSubsection(title: "Dynamic Interaction of Air and Reed", order: 2, paragraphs: [
                        ReedPlateText(text: "The true secret lies in the interaction between the **airflow** and the **reed’s shape and position relative to the channel on the **reed plate**. Imagine blowing through a narrow passage. If that passage narrows at some point, the air will accelerate there. When air accelerates, it exerts less pressure on its surroundings. This is similar to what happens with the air around an accordion reed. The **free reed** is positioned so that in its resting state, it stands slightly clear of the reed plate, creating a small passage for air. This initial displacement is called the **offset** or **clearance**. When the bellows begin to push air, it passes through this opening and exerts pressure on the reed. However, as the reed moves under this pressure and enters the channel on the plate, the space through which the air passes changes.", imageName: "9.4._free_reed_functional_principle", imageTitle: "Functional Principle of the Reed Plate Under Airflow Action")
                    ]),
                    ReedPlateSubsection(title: "The Role of Pressure Change in Sustaining Oscillations", order: 3, paragraphs: [
                        ReedPlateText(text: "When the reed moves, it changes the size of the opening through which air flows. This change in opening leads to a change in air velocity around the reed. And a change in air velocity, as we said, changes the pressure. It is precisely this **pressure change** that plays a key role in oscillation. More precisely, when the reed moves in one direction under air pressure, it narrows the air passage. This narrowing accelerates the air, and the accelerated air creates a zone of **reduced pressure behind the reed**. This reduced pressure \"pulls\" the reed back, opposing the direction of the initial air pressure.")
                    ]),
                    ReedPlateSubsection(title: "Reed Elasticity as an Additional Restoring Force", order: 4, paragraphs: [
                        ReedPlateText(text: "At the same time, the **elasticity** of the reed itself opposes its bending and also pushes it back to its original position. When the reed returns to or near its neutral position, the elastic force carries it further, in the opposite direction of the initial bend. Now, when the reed moves in the opposite direction, it again changes the air passage, creating new pressure changes that push it back again. This continuous cycle of air pressure change due to the reed's movement and the elastic force of the reed itself sustains the oscillation. Thus, it's not just direct air pressure that drives the oscillation, but also the **dynamic pressure changes** that arise from the reed's own movement and interaction with the airflow.")
                    ]),
                    ReedPlateSubsection(title: "Significance of Precise Reed Position and Offset", order: 5, paragraphs: [
                        ReedPlateText(text: "For this system to function optimally and produce a clear tone, the reed's positioning relative to the reed plate is very important. There is a small initial gap, the so-called **offset** or **clearance**. The size of this offset is critical. If it's too small, it can lead to **muffled tones** and **noise** at higher bellows pressure. If it's too large, more air is consumed, and the tone might be delayed at lower pressures. Accordion manufacturers carefully determine the **optimal offset** for each reed to achieve the best balance between response speed, sound intensity, and tone quality, which is crucial for the instrument's performance.")
                    ]),
                    ReedPlateSubsection(title: "Impact of Offset on Airflow and Tone Quality", order: 6, paragraphs: [
                        ReedPlateText(text: "The size of the offset also influences the **amplitude of the reed's oscillation**, meaning how far the reed moves side-to-side. A larger amplitude generally means a louder sound. That's why accordions with a larger reed offset can produce a stronger sound. However, a larger amplitude also requires a **thicker reed plate** to withstand greater stresses.")]),
                    ReedPlateSubsection(title: "Reed Oscillation and Sound Production: Step by Step", order: 7, paragraphs:[
                        ReedPlateText(text: """
                            During one complete oscillation cycle, the reed passes through several key positions relative to the plate, and the airflow continuously changes. At moments when the airflow is abruptly interrupted due to the reed's movement, **sound wave impulses** are generated. The frequency of these interruptions corresponds to the **pitch** we hear. To better understand this process, we can divide it into the following phases:  
                            **1.\tInitial Pressure:** When you press the bellows, air flows over the reed. This pressure reduces the reed's initial offset and increases the velocity of the passing air. This change in velocity creates a pressure change behind the reed, further contributing to its movement.  
                            **2.\tFirst Sound Impulse:** When the leading edge of the reed reaches the level of the plate, the airflow abruptly decreases, creating the first sound wave impulse. The reed continues to move within the plate channel, and its amplitude grows under the influence of air pressure.  
                            **3.\tMaximum Amplitude and Return:** Once the reed reaches its maximum amplitude within the channel, the material's elastic force begins to pull it back. Simultaneously, the air pressure decreases due to the larger space around the reed.  
                            **4.\tSecond Sound Impulse:** On its return, when the leading edge of the reed again passes through the level of the plate, a second sound wave impulse is created. The reed continues to move out of the plate channel to its maximum amplitude in the opposite direction, then returns to its neutral position as the air pressure decreases.
                            """)]),
                    ReedPlateSubsection(title: "Complexity of Reed Systems", order: 8, paragraphs: [
                        ReedPlateText(text: "An accordion contains a large number of reeds of different sizes, adapted to produce various tones. It's important to note that the reeds on the right side, responsible for higher frequencies, are significantly smaller than those on the left side, which produces lower tones. For example, a professional four-voice concert accordion has as many as 256 reeds on its right side. All these reeds are carefully designed and positioned to collectively create a rich and balanced sound.", imageName: "9.4._free_reed_comparation", imageTitle: "Comparative View of the Right and Left Reed Plate Sizes")]),
                    ReedPlateSubsection(title: "Improving Sound Quality", order: 9, paragraphs: [
                        ReedPlateText(text: "The **rigidity of the reed plate** to which the reed is attached is also important for sound quality. Some manufacturers have used **block systems** where multiple reeds share a single, larger plate. This increases rigidity and can contribute to a specific, strong metallic timbre, characteristic of some high-end Russian-made concert accordions.", imageName: "9.4._free_reed_bayan", imageTitle: "Reed Plate in the Jupiter Accordion Reed Block"),
                        ReedPlateText(text: "In conclusion, the oscillation of free reed is a **complex process** that depends not only on direct air pressure but also on the **dynamic pressure changes** arising from the reed's movement and its interaction with the airflow, as well as on the **elastic properties of the reed itself** and its **precise positioning** relative to the reed plate. All these factors together determine the characteristics of the tone we hear.")])
                ])
                
                // MARK: -------------------------------------------------- 9.5. FREE REED FACTORIES --------------------------------------------------
                
                let reedplateFactories = ReedPlateSection(title: "Reed Plate Factories", order: 6, subsections: [
                    ReedPlateSubsection(title: "Reed Plates: Legacy and Modern Manufacturers", order: 1, paragraphs: [
                        ReedPlateText(text: "This section delves into the fascinating world of **reed plates**, the pivotal components that give accordions their voice. Historically, renowned accordion manufacturers like **Hohner, Dallapè, and Paolo Soprani** independently produced all their parts, including these vital plates. Over time, however, specialization emerged, giving rise to companies focused exclusively on crafting reed plates for a wide array of accordion makers."),
                        ReedPlateText(text: "The production of these plates represents a unique engineering process, predominantly based on **metalworking technologies**, which sets it apart from other stages of manufacturing. Significantly, the heart of this specialized industry is located in **Castelfidardo** and its surrounding Italian towns.")]),
                    ReedPlateSubsection(title: "Leading Figures in Italian Reed Plate Development", order: 2, paragraphs: [
                        ReedPlateText(text: """
                            **\u{25CF}\tLuigi Antonelli (1907-1980):** A visionary who founded a factory dedicated to producing reed plates in Osimo in 1935. His commitment to quality led to impressive production volumes, reaching over 100,000 plates daily between 1950 and 1955. After his passing, the factory was taken over by his son, Vinicio Antonelli (1937-2001). Today, his grandson continues the family tradition as a director at **Voci Armoniche**, a company that now includes the Antonelli brand.  
                            **\u{25CF}\tAlessandro and Remo Breccia:** Founders of **Salpa di Breccia & C. Srl.** in Castelfidardo in 1946. Their company became synonymous with the production of top-quality reed plates, supplying prestigious manufacturers like Paolo Soprani and Settimio Soprani. Their son, Romulo Breccia, continued managing the factory, which is now part of the Voci Armoniche group. His son, Giansandro Breccia, currently serves as sales manager.  
                            **\u{25CF}\tMuzio Cagnoni (1915-1995):** Born in Stradella, he perfected his mastery in reed plate manufacturing while working at the Dallapè factory. In 1946, he moved to Castelfidardo and established his own company, focusing on producing high-quality reed plates.  
                            **\u{25CF}\tClaudio Binci:** Another significant name in Castelfidardo, founder of **Binci**, known for exceptionally high-quality reed plates.  
                            In addition to those mentioned, **Artigiana Voci** is also active in Castelfidardo, successfully maintaining traditional production processes. Unfortunately, companies such as Magnatera, Guidobaldi, Catraro, Casali, Severini, Sabattini, and Siva have ceased operations due to reduced production volumes.
                            """)]),
                    ReedPlateSubsection(title: "Global Impact of Italian Manufacturers", order: 3, paragraphs: [
                        ReedPlateText(text: "It's important to note that **all leading global manufacturers of professional concert accordions utilize reed plates produced in Italy**, a testament to the exceptional quality and tradition of this region.")]),
                    ReedPlateSubsection(title: "New Players on the Scene", order: 4, paragraphs: [
                        ReedPlateText(text: """
                            **\u{25CF}\tTitlbach Family:** In 1999, they founded the **Harmonikas** factory in Louny, Czech Republic, strategically positioned between Prague and the German city of Chemnitz, in the heart of Bohemia. This factory specializes in the production of reed plates.  
                            **\u{25CF}\tRussia and Belarus:** For the needs of domestic accordion manufacturers, reed plates are produced by specialized factories that emerged from the transformation of large state-owned musical instrument enterprises. An example is **Muzprom in Moscow**, known for producing all types of **reed blocks** and reeds under the **Agla** brand.  
                            **\u{25CF}\tChina:** Chinese accordion manufacturers employ a differentiated approach depending on the instrument's quality. **Italian reed plates** are used for concert accordions, while plates from their **own serial production** are installed in amateur and school accordions.
                            """)])
                ])
                
                // MARK: -------------------------------------------------- 9.6. QUALITY OF THE REED PLATE --------------------------------------------------
                
                let reedPlateQuality = ReedPlateSection(title: "Quality of the Reed Plate", order: 7, subsections: [
                    ReedPlateSubsection(title: "Quality Characteristics of Reed Plates", order: 1, paragraphs: [
                        ReedPlateText(text: """
                            
                            **1) Reed Material:**  
                            **Steel type:** For the reed tongue's performance, the steel type is crucial, with its chemical and mechanical characteristics being essential. **Strength:** The typical strength of special spring steel is 2000±50N/mm2.  
                            **2) Reed Plate Material:**  
                            **Material type:** The mechanical characteristics of the material from which the **reed plate** is made are essential for stability and resonance.  
                            **3) Manufacturing Precision:**  
                            **Reed accuracy:** Manufacturing tolerances for the reed tongue itself must be minimal. **Plate slot accuracy:** The precision of the **reed plate slot** manufacturing, with a tolerance field within IT standards, is crucial for proper reed vibration.  
                            **4) Surface Finish Quality:**  
                            **Reed and plate slot:** The quality of the machined surface of the reed tongue and the interior of the plate slot is measured by the Ra parameter [µm]. Lower Ra values indicate a smoother surface and higher quality.  
                            **5) Assembly Accuracy:**  
                            **Reed fastening:** Precision during **riveting** the reed tongue to the plate is essential. **Reed positioning:** Accurate positioning of the reed tongue relative to the plate slot ensures optimal airflow.  
                            **6) Reed Tip Deflection:**  
                            **Height above plate plane:** Precise adjustment of the reed tongue's tip deflection relative to the plate plane directly affects the sound.  
                            **7) Valve Quality:**  
                            **Leather/foil valve:** The quality, elasticity, and durability of the valve material (leather or foil) are important for airtightness. **Leaf spring:** Accurate placement of the leaf spring on the valve ensures proper sealing.  
                            **8) Adhesive Quality:**  
                            **Valve and spring adhesion:** The type and quality of the adhesive used for attaching the valve and spring holder must be high.
                            """)
                    ]),
                    ReedPlateSubsection(title: "Manual vs. Machine Manufacturing", order: 2, paragraphs: [
                        ReedPlateText(text: "**Manual manufacturing** (*”tipo a mano”* or *”hand-made”*) of reed plates achieves the highest level of quality. This process allows for: **Precise positioning:** The reed tongue is initially lightly fastened, allowing for fine adjustment with special tools to achieve perfectly equal side clearances and accurate deflection. **Final fastening:** After optimal positioning, the reed tongue is definitively and firmly riveted to the plate. This individual approach guarantees a quality that is difficult to achieve in automated machine production."),
                        ReedPlateText(text: "**Machine manufacturing** (*”tipo a macchina”* or *”machine-made”*) is more productive and economical, but it cannot achieve the same precision necessary for top-tier concert accordions. It is used for serial production of amateur, studio, and school accordions.")]),
                    ReedPlateSubsection(title: "Quality Categorization of Reed Plates (Italian Manufacturers)", order: 3, paragraphs: [
                        ReedPlateText(text: """
                            
                            Italian manufacturers typically classify their reed plates into five basic quality groups:  
                            **1) Economy line (Standard level):**  
                            **Usage:** School and amateur accordions. **Plate:** Aluminum or Avional 5000 series alloy (65-70 HB). **Reed:** Special spring steel (2000±50N/mm2). **Plate slots:** Punched on a press (IT5 tolerances). **Reed finish:** Fine grinding (Ra =1.4µm). **Assembly:** Machine riveting. **Clearances:** Front 0.04 mm, side 0.03-0.05 mm. **Frequency accuracy:** Up to 10 cents. **Other designations:** New economy line, Tipo C, Commercial, Mechanic.  
                            **2) Super durall (Medium level):**  
                            **Usage:** Studio and semi-professional accordions. **Plate:** Avional 5000 series alloy (80-100 HB). **Reed:** Special spring steel (2000±50N/mm2). **Plate slots:** Punched in a die on a press (IT5 tolerances). **Reed finish:** Fine grinding (Ra =1.4µm). **Assembly:** Manual and machine riveting. **Clearances:** Front 0.03 mm, side 0.03-0.04 mm. **Frequency accuracy:** Up to 5 cents. **Other designations:** Durall, Esportazione, Super, Export dural, Voci B turbo.  
                            **3) Tipo a mano durall extra (Higher level):**  
                            **Usage:** Semi-professional and accordions for folk/traditional music. **Plate:** Avional 2000 series alloy (120-140 HB). **Reed:** Special Swedish spring steel (2000±50N/mm2). **Plate slots:** Punched and calibrated (IT4 tolerances). **Reed finish:** Fine grinding (Ra =1.2µm). **Assembly:** Manual. **Clearances:** Front 0.025 mm, side 0.025-0.03 mm. **Frequency accuracy:** Up to 5 cents. **Other designations:** Tipo a mano avional, Imitazione tipo a mano, Voci in duralluminio avional.  
                            **4) Tipo a mano (High level):**  
                            **Usage:** Professional concert and folk music accordions. **Plate:** Avional 2000 series alloy (140-150 HB). **Reed:** Special Swedish "vocal" spring steel (2000±50N/mm2), naturally aged. **Plate slots:** Electro-erosion machining (IT3 tolerances). **Reed finish:** Fine grinding and manual polishing (Ra =1.0µm), anti-corrosion protection. **Assembly:** Manual, with special tools. **Clearances:** Front 0.025 mm, side 0.02-0.03 mm. **Frequency accuracy:** Up to 5 cents.  
                            **5) A mano (Highest level):**  
                            **Usage:** Highest quality concert accordions. **Plate:** Avional 2000 series alloy (150-160 HB). **Reed:** Special Swedish "vocal" spring steel (2000±50N/mm2), multi-year natural aging. **Plate slots:** Laser or electro-erosion machining (IT3 tolerances). **Reed finish:** Fine grinding and manual polishing (Ra =0.8µm), anti-corrosion protection, high level of final finishing. **Assembly:** Manual, with special tools. **Clearances:** Front 0.02 mm, side 0.015-0.02 mm. **Frequency accuracy:** Up to 3 cents, adjusted to absolute accuracy during final installation.
                            """)]),
                    ReedPlateSubsection(title: "Problem of Standardization and Quality Verification", order: 4, paragraphs: [
                        ReedPlateText(text: "It's important to note that there are no national or international standards for the quality characteristics of free reed plates. Furthermore, there are no accredited testing and verification methods, nor certification institutions."),
                        ReedPlateText(text: "Reed plates often lack mandatory quality markings. Occasionally, you might find an embossed manufacturer's mark or the name of the master who manually performed the assembly (e.g., *Severini*, *Mazzieri*, *Morlaki*, *Sabatini*), but many plates are unmarked. Accordion manufacturers frequently apply their own markings, which further complicates identifying the true manufacturer and quality class.")]),
                    ReedPlateSubsection(title: "How to Determine Quality?", order: 5, paragraphs: [
                        ReedPlateText(text: """
                            The quality of reed plates is primarily determined by visual inspection and analysis of characteristic details:  
                            \u{25CF}\t**Rivet heads:** The difference in riveting technology is evident between hand-made and machine-made construction.  
                            \u{25CF}\t**Surface finish:** The quality of reed tongue grinding and plate slot, as well as the finishing of the slot edges.  
                            \u{25CF}\t**Rivet appearance:** How the reed tongue is attached to the plate.  
                            \u{25CF}\t**Size and uniformity of clearances:** Side clearances between the reed tongue and the slot walls must be small and uniform.  
                            \u{25CF}\t**Front clearance:** Precise size of the front clearance.  
                            \u{25CF}\t**Steel color:** Higher quality steels may have a specific color.  
                            \u{25CF}\t**Valves:** The way the leather/foil valve is installed can indicate a higher quality class (“*A mano”*).  
                            It is more challenging to discern differences between lower quality classes (e.g., *Super durall* and *Tipo a mano durall extra*) or between higher classes (*Tipo a mano durall extra* and *Tipo a mano*), where the differences are often subtle.
                            """)])
                ])
                
                // MARK: -------------------------------------------------- 9.7. ADJUSTING THE OSCILLATION FREQUENCY OF THE FREE REED --------------------------------------------------
                
                let reedPlateAdjusting = ReedPlateSection(title: "Adjusting the Oscillation Frequency of the Free Reed", order: 8, subsections: [
                    ReedPlateSubsection(title: "Precise Reed Frequency: Importance and Measurement Phases", order: 1, paragraphs: [
                        ReedPlateText(text: "The precise **oscillation frequency** of each **free reed** is essential for the correct **pitch** when playing the accordion. Frequency can be measured at various stages: individually for the reed plate, on the **reed block**, and when the reed block is installed in the accordion's body."),
                        ReedPlateText(text: "Each reed plate is designed and manufactured for a specific **nominal frequency**, with a tolerance expressed in **cents** that depends on the reed plate's quality. Final frequency adjustment is a demanding process, especially for concert accordions with a large number of reeds (up to 512 on the treble side alone).")]),
                    ReedPlateSubsection(title: "Automated Frequency Adjustment", order: 2, paragraphs: [
                        ReedPlateText(text: """
                            Leading accordion manufacturers adjust the frequency before installation onto the reed block to optimize final control. Companies like Pigini use an automated robotic cell for this process:  
                            \u{25CF}\t**Robotic Gripper:** Picks up the reed plate and places it in the measurement position.  
                            \u{25CF}\t**Plate Clamping:** The reed plate is secured.  
                            \u{25CF}\t**Airflow:** A controlled airflow is supplied.  
                            \u{25CF}\t**Frequency Measurement:** The oscillation frequency is precisely measured.  
                            \u{25CF}\t**Sensors:** The cell is equipped with sensors for position, airflow velocity, force, pressure, and temperature, taking all relevant factors into account.  
                            \u{25CF}\t**Precise Positioning:** The reed plate is moved so that the grinding belt contacts either the base or the tip of the reed, depending on whether the frequency needs to be increased or decreased.  
                            \u{25CF}\t**Micron-Controlled Engagement:** A computer-controlled press automatically lowers the grinding belt with exceptional precision.  
                            \u{25CF}\t**Grinding:** Material is removed from the base (to decrease frequency) or the tip (to increase frequency) of the reed until absolute frequency accuracy is achieved.  
                            \u{25CF}\t**Process Control:** The robotic station regulates air pressure (adapting to reed size) and grinding belt speed (adapting to the reed's mechanical characteristics).
                            """)]),
                    ReedPlateSubsection(title: "Importance of Final Tuning", order: 3, paragraphs: [
                        ReedPlateText(text: "The **sound spectrum of a free reed** on a reed plate differs significantly from the spectrum of the same reed plate on a **reed block** or when the reed block is installed in the **accordion body**. The **reed block's resonant chamber** and the accordion body amplify higher harmonics, giving them a more dominant influence on the timbre and a greater amplitude."),
                        ReedPlateText(text: "Therefore, checking the frequency on the reed plate has a **functional character**, while checking it on the reed block within the accordion body has an **acoustic and musical significance**. The final testing of the oscillation frequency, known as **reed voicing or tuning the reeds**, is a crucial operation in the production of concert accordions.", imageName: "9.7._reed_plate_tuning_software", imageTitle: "Software for Free Reed Tuning")]),
                    ReedPlateSubsection(title: "Manual Voicing Process", order: 4, paragraphs: [
                        ReedPlateText(text: "Reliable frequency checking under real-world conditions is only possible when the reed blocks are in the accordion body on a **specialized test bench** with appropriate measuring equipment. This bench features a *bellows*, allowing frequency measurement of both outer and inner reeds by changing the bellows' direction of movement.", imageName: "9.7._specialized_test_bench", imageTitle: "Specialized test bench (Pigini Company)"),
                        ReedPlateText(text: "The final frequency adjustment is one of the last technological operations in production. It's also periodically repeated during servicing. Over time, due to loss of steel elasticity, moisture, impurities, temperature, and other influences, the reeds can change their nominal frequency, leading to the instrument going out of tune."),
                        ReedPlateText(text: """
                            Voicing can only be performed by a trained technician or specialist in a service workshop at room temperature, by correcting the mass distribution along the reed:  
                            \u{25CF}\t**Increasing frequency:** Mass is reduced at the tip of the reed.  
                            \u{25CF}\t**Decreasing frequency:** Mass is reduced at the base of the reed.
                            """),
                        ReedPlateText(text: "To reduce mass, a **shim** accessory is used to separate the reed from the plate and protect it from damage. Material is removed by grinding with a hand abrasive tool or a small electric grinder with a fine ball-shaped attachment. This process is empirical and takes place in multiple stages, with frequency measurement after each grinding phase, until the exact nominal frequency is achieved. The procedure is repeated for all reeds on both the right and left sides.")]),
                    ReedPlateSubsection(title: "Voicing Outer and Inner Reeds", order: 5, paragraphs: [
                        ReedPlateText(text: "Mass reduction is simpler for **outer reeds**. For **inner reeds**, the process is more complicated due to difficult access inside the resonant chamber. A **lifter**accessory (a small hook) is passed through an opening on the reed block to pull the tip of the inner reed above the plate, allowing the shim to be placed. The reed plate channel needs to be cleared of its valve before grinding. For decreasing the frequency of inner reeds, extremely small grinding tools are used to avoid damaging the channel edges. After grinding, the reed is polished to remove any processing marks."),
                        ReedPlateText(text: """
                            It's important that voicing is performed correctly and carefully, using **adequate accessories** and tools. Instead of grinding the reed tip, a fine file can also be used. After each voicing, it's essential to remove all material particles and impurities from the reed blocks.  
                            Under careful conditions, voicing of outer reeds can also be done when the reed blocks are in the accordion body. However, for inner reeds, removing the reed block is necessary.
                            """, imageName: "9.7._fine_file_tuning", imageTitle: "Adjusting Reed Oscillation Frequency by Mass Reduction")]),
                    ReedPlateSubsection(title: "Improper Voicing Methods", order: 6, paragraphs: [
                        ReedPlateText(text: "On older accordions, **deep scratches** can often be observed at the base of the reeds, caused by longitudinal scoring with a sharp tool during voicing. Although this method can decrease the frequency, it significantly and permanently reduces the reed's dynamic stiffness. Scratches create stress concentration, reduce strength and resistance to dynamic loads, often leading to reed breakage.", imageName: "9.7._reed_bad_file", imageTitle: "Characteristic Traces of Oscillation Frequency Adjustment on Reeds"),
                        ReedPlateText(text: "Improper mass reduction by scoring is characteristic of untrained technicians who want to speed up the voicing process, especially for inner reeds, disregarding the negative consequences for the instrument. From a technical and technological standpoint, frequency adjustment by longitudinal scoring at the base of a free reed is completely unacceptable.")])
                ])
                
                modelContext.insert(reedPlate)
                modelContext.insert(reedPlateConstruction)
                modelContext.insert(reedPlateDependences)
                modelContext.insert(reedPlateDimensioning)
                modelContext.insert(reedPlateFunctional)
                modelContext.insert(reedplateFactories)
                modelContext.insert(reedPlateQuality)
                modelContext.insert(reedPlateAdjusting)

            }
        } catch {
            print("Error loading Reed Plate data: \(error)")
        }
    }
}
